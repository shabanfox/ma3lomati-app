import streamlit as st
import pandas as pd
import io

# 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
st.set_page_config(page_title="ููุตุฉ ูุนูููุงุชู ุงูุนูุงุฑูุฉ", layout="wide", initial_sidebar_state="collapsed")

# 2. ุชุตููู CSS ุงูููุญุฏ (ุฃุณูุฏ ูุฐูุจู ูุน ุฎุทูุท ุนุฑูุถุฉ)
st.markdown("""
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
    
    #MainMenu, footer, header, [data-testid="stHeader"] {visibility: hidden; display: none;}
    
    html, body, [data-testid="stAppViewContainer"] { 
        direction: RTL; text-align: right; font-family: 'Cairo', sans-serif; background-color: #ffffff; 
    }

    .hero-banner { 
        background: #000000; color: #f59e0b; padding: 25px; border-radius: 20px; 
        text-align: center; margin-bottom: 30px; border: 4px solid #f59e0b;
        box-shadow: 10px 10px 0px #000;
    }
    .hero-banner h1, .hero-banner h2 { font-weight: 900; color: #f59e0b !important; margin: 0; }

    /* ุณุชุงูู ุงููุฑูุช ุงูููุญุฏ */
    .custom-card {
        background: #ffffff; border: 4px solid #000; padding: 20px; 
        border-radius: 20px; margin-bottom: 20px; box-shadow: 8px 8px 0px #000;
        text-align: right; transition: 0.3s;
    }
    .card-title { font-size: 1.6rem; font-weight: 900; color: #000; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 15px; }
    .card-label { font-weight: 900; color: #000; font-size: 1.1rem; }
    .card-val { font-weight: 700; color: #f59e0b; font-size: 1.1rem; margin-bottom: 8px; }

    /* ุฃุฒุฑุงุฑ ุงูุชููู ูุงูุชุญูู */
    div.stButton > button {
        border: 3px solid #000 !important; border-radius: 15px !important;
        box-shadow: 5px 5px 0px #000 !important; font-weight: 900 !important;
        background-color: #fff !important; color: #000 !important;
        height: auto !important; padding: 10px 20px !important;
    }
    div.stButton > button:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0px #f59e0b !important; border-color: #f59e0b !important; }

    input { border: 3px solid #000 !important; border-radius: 10px !important; font-weight: 700 !important; }
    label { font-weight: 900 !important; font-size: 1.1rem !important; }
    </style>
""", unsafe_allow_html=True)

# 3. ุชุญููู ุงูุจูุงูุงุช ุงููุงููุฉ
@st.cache_data
def load_full_data():
    raw_data = """Developer,Owner,Projects,Area,Price,Min_Val,Description,Type,Delivery,Installments,Down_Payment,Detailed_Info
Mountain View,ุนูุฑู ุณูููุงู,iCity,ุงูุชุฌูุน,8.5M,850K,ูุฌุชูุนุงุช ุงูุณุนุงุฏุฉ,ุณููู,2027,8,10%,ูุธุงู 4D ุงููุจุชูุฑ ููุตู ุญุฑูุฉ ุงูุณูุงุฑุงุช
Palm Hills,ูุงุณูู ููุตูุฑ,Badya,ุฒุงูุฏ,12M,1.2M,ุฑุงุฆุฏ ุงูุณูู,ูุงุฎุฑ,2026,7,10%,ุฃูู ูุฏููุฉ ูุณุชุฏุงูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
SODIC,ุณูุฏูู,Villette,ุงูุชุฌูุน,13M,650K,ุฌูุฏุฉ ุนุงูููุฉ,ุณููู,2025,7,5%,ุฃููู ุฅุฏุงุฑุฉ ูุฑุงูู ูุตูุงูุฉ ูู ูุตุฑ
Emaar Misr,ูุญูุฏ ุงูุนุจุงุฑ,Mivida,ุงูุชุฌูุน,18M,900K,ูุฎุงูุฉ ุฅูุงุฑุงุชูุฉ,ุนุงููู,2026,8,5%,ุฃุนูู ุนุงุฆุฏ ุงุณุชุซูุงุฑู (Resale) ูู ุงูุณูู
Ora Dev,ูุฌูุจ ุณุงููุฑุณ,Zed,ุฒุงูุฏ,16M,1.6M,ุฑูุงููุฉ ุงูุฃุจุฑุงุฌ,ูุงุฎุฑ,2028,8,10%,ุชุดุทูุจุงุช ููุฏููุฉ ูุงููุฉ ุจุงูุชููููุงุช ูุงููุทุจุฎ
Hassan Allam,ุญุณู ุนูุงู,Swan Lake,ูุณุชูุจู,15.5M,775K,ููุฉ ุงูุฑูู,ูุงุฎุฑ,2026,7,5%,ุงููุทูุฑ ุงูููุถู ููุทุจูุฉ ุงูุฃุฑุณุชูุฑุงุทูุฉ
Madinet Masr,ุนุจุฏ ุงููู ุณูุงู,Sarai,ุงูุชุฌูุน,7.2M,720K,ุชุงุฑูุฎ ุนุฑูู,ุณููู,2025,8,10%,ุฃูุจุฑ ูุงุฌูู ุตูุงุนู ูู ุงููุงูุฑุฉ ุงูุฌุฏูุฏุฉ
Tatweer Misr,ุฃุญูุฏ ุดูุจู,Bloomfields,ูุณุชูุจู,9.5M,475K,ุงุจุชูุงุฑ ุชุนูููู,ูุชููุฒ,2027,8,5%,ููุทูุฉ ุฌุงูุนุงุช ุฏูููุฉ ุฏุงุฎู ุงูููุจููุฏ
TMG,ูุดุงู ุทูุนุช,ูุฏููุชู,ุงูุณููุณ,11M,1.1M,ูุฏู ูุชูุงููุฉ,ูุฏููุฉ,2027,10,10%,ูุธุงู ุฅุฏุงุฑุฉ ุฐููุฉ ูุงููุฉ ูุชุญุตูู ุฅููุชุฑููู
Nile Dev,ูุญูุฏ ุทุงูุฑ,Nile Towers,ุงูุนุงุตูุฉ,5.2M,520K,ูููู ุงูุฃุจุฑุงุฌ,ุชุฌุงุฑู,2028,10,10%,ุซุงูุซ ุฃุนูู ูุงุทุญุฉ ุณุญุงุจ ูู ุฃูุฑูููุง
La Vista,ุนูุงุก ุงููุงุฏู,LV City,ุงูุนุงุตูุฉ,15M,2.2M,ูููุงุช ูุงุฎุฑุฉ,ูุงุฎุฑ,2026,6,15%,ููุฉ ููุงุกุฉ ูุงููุฉ ุฌุจุงุฑุฉ ูุจูุงุก ุฐุงุชู
LMD,ุฃุญูุฏ ุตุจูุฑ,One Ninety,ุงูุชุฌูุน,10.5M,1.05M,ุชุฌุฑุจุฉ ููุฏููุฉ,ูุชููุฒ,2027,8,10%,ูุถู ููุฏู W Global ูููุทูุฉ ุชุฌุงุฑูุฉ ุนุงูููุฉ
Misr Italia,ุนุงุฆูุฉ ุงูุนุณุงู,IL Bosco,ุงูุนุงุตูุฉ,6.5M,650K,ุบุงุจุงุช ุนููุฏูุฉ,ุณููู,2026,9,10%,ุฃูู ูุทูุฑ ูุทุจู ููููู ุงูุฃุดุฌุงุฑ ุนูู ุงููุจุงูู
Orascom,ุณููุญ ุณุงููุฑุณ,O West,ุฃูุชูุจุฑ,11.5M,575K,ูุทูุฑ ุงูุฌููุฉ,ุนุงููู,2026,8,5%,ุฑูุญ ุงูุฌููุฉ ูู ููุจ ูุฏููุฉ ุฃูุชูุจุฑ
PRE,ุฃุฏูุจ ุณูุงูุฉ,The Brooks,ุงูุชุฌูุน,9.2M,920K,ุชุตุงููู ููุฏุณูุฉ,ูุชููุฒ,2027,8,10%,ุดูุงูุงุช ูุงุฆูุฉ ูููุงุธุฑ ุทุจูุนูุฉ ูุฑูุฏุฉ
Marakez,ููุงุฒ ุงูุญููุฑ,District 5,ุงููุทุงููุฉ,10.8M,1.08M,ูููุงุช ูุณูู,ูุชูุงูู,2026,8,10%,ุตุงุญุจ ููู ุงูุนุฑุจ ููุฑุจุท ุงูุชุฌูุน ุจุงูุณุฎูุฉ
City Edge,ุญูููู,North Edge,ุงูุนูููู,14M,700K,ุงููุทูุฑ ุงููุทูู,ููุฏูู,2025,7,5%,ูุงุทุญุงุช ุณุญุงุจ ูุจุงุดุฑุฉ ุนูู ุงูุจุญุฑ
Hyde Park,ูุงุฌุฏ ุดุฑูู,Hyde Park,ุงูุชุฌูุน,9M,900K,ุงูููุจ ุงูุฃุฎุถุฑ,ุณููู,2026,8,10%,ุฃูุจุฑ ูุงุฏู ุฑูุงุถู ุจุงููุงูุฑุฉ ุงูุฌุฏูุฏุฉ
Inertia,ุฃุญูุฏ ุงูุนุฏูู,Jefaira,ุงูุณุงุญู,7.9M,790K,ุฌูู ุงูุดุจุงุจ,ุณูุงุญู,2027,8,10%,ูุฏููุฉ ุณุงุญููุฉ ุชุนูู ุทูุงู ุงูุนุงู
Iwan,ูููุฏ ูุฎุชุงุฑ,The Axis,ุฒุงูุฏ,8.4M,840K,ุชูุงุฒู ููุณู,ููุฏุฑู,2026,8,10%,ููุณูุฉ ุงูู Wellness ููุณุงุญุงุช ููุชุฃูู
Akam,ุนุตุงู ููุตูุฑ,Scene 7,ุงูุนุงุตูุฉ,5.5M,550K,ุณูู ุฑูุงุถู,ุณููู,2026,10,10%,11 ุฃูุงุฏูููุฉ ุฑูุงุถูุฉ ุฏูููุฉ ุจุงูููุจููุฏ
Taj Misr,ูุตุทูู ุฎููู,De Joya,ุงูุนุงุตูุฉ,4.8M,240K,ุงูุฃูุซุฑ ูุจูุนุงู,ุงูุชุตุงุฏู,2026,10,5%,ุฃูู ูุณุจุฉ ุชุญููู ูู ูุณุงุญุงุช ุงูุดูู
Equity,ุฃุญูุฏ ุงูุณููุฏู,Waterway,ุงูุชุฌูุน,13.5M,2.0M,ุงูุฑูุงููุฉ,ูุงุฎุฑ,2025,7,15%,ุงูุจุฑุงูุฏ ุฑูู 1 ูู ูุตุฑ ุญุงููุงู
New Giza,ุตูุงุญ ุฏูุงุจ,New Giza,ุฃูุชูุจุฑ,14M,2.1M,ุงููุฎุงูุฉ,ูุงุฎุฑ,2025,6,15%,ุฃุฑูู ูุฌุชูุน ุณููู ูุชูุงูู ูู ุฃูุชูุจุฑ
Saudi Egy,ุดุฑุงูุฉ ุฏูููุฉ,Jayd,ุงูุชุฌูุน,9.8M,980K,ุซูุฉ ุฏูููุฉ,ูุชููุฒ,2026,8,10%,ุดุฑูุฉ SED ุงูุนุฑููุฉ ุจุณุงุจูุฉ ุฃุนูุงู ุถุฎูุฉ
Living Yards,ุฃููู ูุฑุฒูู,The Loft,ุงูุนุงุตูุฉ,6.2M,620K,ูุฑููุฉ ุงูุชูุณูู,ููุฏุฑู,2027,8,10%,ุดูู ุจุฏูู ุฃุนูุฏุฉ ุฏุงุฎููุฉ ููุชูุณูู ุงูุญุฑ
Sky Abu Dhabi,ุตุงูุญ ุงูุณุนุฏู,Resid. 8,ุงูุนุงุตูุฉ,6.4M,640K,ุฌูุฏุฉ ุฅูุงุฑุงุชูุฉ,ุณููู,2026,8,10%,ูููุน ุงุณุชุฑุงุชูุฌู ุจุฌูุงุฑ ุงูุญู ุงูุฏุจูููุงุณู
Gates Dev,ุฃุจู ุงููุชูุญ,Venia,ุงูุนุงุตูุฉ,5.3M,530K,ููุงุณูู,ุณููู,2027,8,10%,ุณุฑุนุฉ ุฅูุดุงุกุงุช ุฌุจุงุฑุฉ ูุชุฎุตูุต ุนุงุฆูู
MBG,ุฏ. ูุญููุฏ ุงูุนุฏู,Pukka,ุงูุนุงุตูุฉ,4.9M,490K,ูุทูุฑ ุทุจู,ุณููู,2026,9,10%,ุฎุฏูุงุช ุทุจูุฉ ูุชุทูุฑุฉ ูุฃูุงุฏูููุงุช ุฑูุงุถูุฉ
Capital Link,ุฃุดุฑู ุจุฏูู,Kardia,ุงูุนุงุตูุฉ,4.5M,450K,ุงุณุชุซูุงุฑ ุฐูู,ุชุฌุงุฑู,2028,10,10%,ููุงูุน ุงูุฏุงูู ุชุงูู ุงููุฑูุจุฉ ูู ุงูููููุฑูู
Ardic,ูุญููุฏ ุญุฌุงุฒู,Zizinia,ูุณุชูุจู,6.9M,690K,ูุฏูุก ุชุงู,ุณููู,2026,8,10%,ุฃูู ูุซุงูุฉ ุณูุงููุฉ ูู ูุณุชูุจู ุณูุชู
People&Places,ูุฑูู ุงูุนุณุงู,The Med,ุงูุณุงุญู,11M,1.1M,ูู ุงููุนูุงุฑ,ุณูุงุญู,2028,8,10%,ุงูุชุฑููุฒ ุนูู ุงูู Lifestyle ุงูุนุงููู
Naia,ุงูุฏูุงุตูุฑู,Naia Bay,ุงูุณุงุญู,10.5M,525K,ุทุฑุงุฒ ูููุงูู,ุณูุงุญู,2027,9,5%,ูุญุฏุงุช ูุชุฏุฑุฌุฉ ุชุทู ุนูู ุงููุฑูุณุชุงู ูุงุฌูู
M Squared,ุฅูุชุฑู ุฌุฑูุจ,Trio,ุงูุชุฌูุน,8.9M,890K,ุฐูุงุก ุงููุณุงุญุงุช,ุณููู,2027,8,10%,ููุฑุฉ ุงูู Trio Villa ุงููุจุชูุฑุฉ
Al Karma,ุฃุจู ุงููุชูุญ,Gates,ุฒุงูุฏ,10.2M,1.02M,ุฑูู ุฒุงูุฏ,ุณููู,2026,7,10%,ูุฏูุก ูุงุฆู ูุฎุตูุตูุฉ ูู ุงูุดูุฎ ุฒุงูุฏ
Arabella,ูุญูุฏ ุฃููู,Direction,ุงูุณุงุญู,9.3M,930K,ุงูููู ุงูุฃุจูุถ,ุณูุงุญู,2027,7,10%,ุชุตูููุงุช ุจูุถุงุก ุจุงููุงูู ูู ุฑุฃุณ ุงูุญููุฉ
Redcon,ุทุงุฑู ุงูุฌูุงู,Golden Gate,ุงูุชุฌูุน,14M,2.1M,ูุจุงูู ุฎุถุฑุงุก,ุฅุฏุงุฑู,2025,6,15%,ุฃุทูู ูุงุฌูุฉ ุชุฌุงุฑูุฉ ุจุงูุชุณุนูู ุงูุฌููุจู
Al Borouj,ูุงุจูุชุงู ุฌุฑูุจ,Al Borouj,ุงูุดุฑูู,8.2M,410K,ูุฌุชูุน ุซูุงูู,ุณููู,2026,8,5%,ูุถู ุณุงููุฉ ุงูุตุงูู ููุฑูุฉ ุฐููุฉ
Valda,ููุฒู ุงููุชููู,Sea Shell,ุงูุณุงุญู,12.5M,1.25M,ุชูุฑุฏ ุณุงุญูู,ุณูุงุญู,2026,6,10%,ููุฏูุฉ ุนุงููุฉ ุงููุณุชูู ูุชุตุงููู ููุฏุฑู
Sorouh,ูุงูู ุงูุจูุฏุงุฑู,Entrada,ุงูุนุงุตูุฉ,5.4M,540K,ุจูุงุจุฉ ุงูุนุงุตูุฉ,ุณููู,2026,10,10%,ุฃูุงู ูุฏููุฉ ุงููุนุงุฑุถ ุจุชุตููู ุงูุณูุงุจู
Edge Stone,ุนูู ุฌุงุจุฑ,Moraya,ุงูุนุงุตูุฉ,5.2M,520K,ุงูุชุฒุงู,ุณููู,2026,8,10%,ูุณุจุฉ ุชุญููู ููููุฉ ุฌุฏุงู ูู ุงูู R8
Contact Dev,ุฃุญูุฏ ููุฑู,Mercury,ุงูุนุงุตูุฉ,4.8M,480K,ุฃุจุฑุงุฌ ุฅุฏุงุฑูุฉ,ุชุฌุงุฑู,2027,10,10%,ุนุงุฆุฏ ุฅูุฌุงุฑู ูุถููู ูู ุงูุฏุงูู ุชุงูู
New Plan,ูููุฏ ุฎููู,Atika,ุงูุนุงุตูุฉ,6.1M,610K,ุทุฑุงุฒ ุฅุณุจุงูู,ุณููู,2026,9,10%,ุดูู ูุงูุจูุฑุฌููู ููุฑูุดุฉ ุจุงููุงูู"""
    # ุณูุชู ูุฑุงุกุฉ ุฃูู 40 ุดุฑูุฉ ุชูุฑูุจุงู ููุซุงูุ ูููููู ุฅุถุงูุฉ ุงูุจููุฉ ุจููุณ ุงููุณู
    return pd.read_csv(io.StringIO(raw_data))

if 'data' not in st.session_state: st.session_state.data = load_full_data()
if 'view' not in st.session_state: st.session_state.view = 'main'
if 'page' not in st.session_state: st.session_state.page = 0
if 'selected_dev' not in st.session_state: st.session_state.selected_dev = None

df = st.session_state.data

# --- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ---
if st.session_state.view == 'main':
    st.markdown('<div class="hero-banner"><h1>๐ ููุตุฉ ูุนูููุงุชู</h1></div>', unsafe_allow_html=True)
    st.write("<div style='height:80px;'></div>", unsafe_allow_html=True)
    _, mid_col, _ = st.columns([0.1, 0.8, 0.1])
    with mid_col:
        c1, c2 = st.columns(2, gap="large")
        with c1:
            if st.button("๐ข\nุฏููู ุงููุทูุฑูู", use_container_width=True): 
                st.session_state.view = 'comp'
                st.rerun()
        with c2:
            if st.button("๐๏ธ\nุฃุฏูุงุช ุงูุจุฑููุฑ", use_container_width=True): 
                st.session_state.view = 'tools'
                st.rerun()

# --- ุตูุญุฉ ุฏููู ุงููุทูุฑูู ---
elif st.session_state.view == 'comp':
    st.markdown('<div class="hero-banner"><h2>๐ข ุฏููู ุงููุทูุฑูู</h2></div>', unsafe_allow_html=True)
    
    if st.button("๐ ุนูุฏุฉ ููุฑุฆูุณูุฉ"): 
        st.session_state.view = 'main'
        st.session_state.selected_dev = None
        st.session_state.page = 0
        st.rerun()
    
    # ุญุงูุฉ ุงูุจุญุซ ููุงุฆูุฉ ุงููุทูุฑูู
    search = st.text_input("๐ ุงุจุญุซ ุนู ุงุณู ุงููุทูุฑ...")
    unique_devs = df['Developer'].dropna().unique()
    if search:
        unique_devs = [d for d in unique_devs if search.lower() in str(d).lower()]

    # ุนุฑุถ ุงูุชูุงุตูู ุฅุฐุง ุชู ุงุฎุชูุงุฑ ูุทูุฑ
    if st.session_state.selected_dev:
        dev_info = df[df['Developer'] == st.session_state.selected_dev].iloc[0]
        st.markdown(f"""
            <div class="custom-card">
                <div class="card-title">
